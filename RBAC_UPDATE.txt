â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         ğŸ­ ROLE-BASED ACCESS CONTROL ADDED! ğŸ­                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… HOÃ€N THÃ€NH - Role System

â”Œâ”€ Roles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  ğŸ‘¤ USER (user) - NgÆ°á»i dÃ¹ng thÃ´ng thÆ°á»ng                      â”‚
â”‚     âœ“ Register, login, use AI                                 â”‚
â”‚     âœ“ View profiles, delete own account                       â”‚
â”‚     âœ— Cannot list all users                                   â”‚
â”‚     âœ— Cannot manage other users                               â”‚
â”‚                                                                â”‚
â”‚  ğŸ‘‘ ADMIN (admin) - Quáº£n trá»‹ viÃªn                              â”‚
â”‚     âœ“ All user permissions                                    â”‚
â”‚     âœ“ List all users                                          â”‚
â”‚     âœ“ Delete any user                                         â”‚
â”‚     âœ“ Promote/demote users                                    â”‚
â”‚     âœ— Cannot change own role                                  â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ What Changed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  ğŸ“ app/models/database.py                                     â”‚
â”‚     + UserRole enum (USER, ADMIN)                             â”‚
â”‚     + role column in User table                               â”‚
â”‚                                                                â”‚
â”‚  ğŸ“ app/schemas/user.py                                        â”‚
â”‚     + UserRole enum                                            â”‚
â”‚     + role field in UserResponse                              â”‚
â”‚     + UserRoleUpdate schema                                   â”‚
â”‚                                                                â”‚
â”‚  ğŸ“ app/core/dependencies.py                                   â”‚
â”‚     + get_current_admin() dependency                          â”‚
â”‚                                                                â”‚
â”‚  ğŸ“ app/services/user_service.py                               â”‚
â”‚     + role parameter in create_user()                         â”‚
â”‚     + update_user_role() method                               â”‚
â”‚                                                                â”‚
â”‚  ğŸ“ app/api/v1/endpoints/users.py                              â”‚
â”‚     + Admin-only protection for list users                    â”‚
â”‚     + PUT /{id}/role endpoint                                 â”‚
â”‚     + Enhanced delete logic                                   â”‚
â”‚                                                                â”‚
â”‚  ğŸ“ init_db.py                                                 â”‚
â”‚     + Auto-create default admin account                       â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Default Admin Account â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  Username: admin                                               â”‚
â”‚  Password: admin123                                            â”‚
â”‚  Email:    admin@dermatology.com                               â”‚
â”‚                                                                â”‚
â”‚  âš ï¸  Created automatically when running: python init_db.py     â”‚
â”‚  âš ï¸  CHANGE PASSWORD IMMEDIATELY after first login!            â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ API Endpoints â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  Public:                                                       â”‚
â”‚    POST   /auth/register  â†’ Register (auto role: user)        â”‚
â”‚    POST   /auth/login     â†’ Login                             â”‚
â”‚                                                                â”‚
â”‚  User (Authenticated):                                         â”‚
â”‚    GET    /auth/me                                             â”‚
â”‚    GET    /users/{id}                                          â”‚
â”‚    POST   /prediction/predict                                 â”‚
â”‚    DELETE /users/{id}  (own account only)                     â”‚
â”‚                                                                â”‚
â”‚  Admin Only:                                                   â”‚
â”‚    GET    /users/  â†’ List all users                           â”‚
â”‚    PUT    /users/{id}/role  â†’ Change role                     â”‚
â”‚    DELETE /users/{id}  (any account)                          â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Quick Start â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  1. Initialize DB (creates admin):                            â”‚
â”‚     $ python init_db.py                                        â”‚
â”‚                                                                â”‚
â”‚  2. Login as admin:                                            â”‚
â”‚     curl -X POST http://localhost:8000/api/v1/auth/login \    â”‚
â”‚       -H "Content-Type: application/json" \                   â”‚
â”‚       -d '{"username":"admin","password":"admin123"}'         â”‚
â”‚                                                                â”‚
â”‚  3. List all users:                                            â”‚
â”‚     curl -X GET http://localhost:8000/api/v1/users/ \         â”‚
â”‚       -H "Authorization: Bearer {admin_token}"                â”‚
â”‚                                                                â”‚
â”‚  4. Promote user to admin:                                     â”‚
â”‚     curl -X PUT http://localhost:8000/api/v1/users/2/role \   â”‚
â”‚       -H "Authorization: Bearer {admin_token}" \              â”‚
â”‚       -H "Content-Type: application/json" \                   â”‚
â”‚       -d '{"role":"admin"}'                                   â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Python Example â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  import requests                                               â”‚
â”‚  BASE = "http://localhost:8000/api/v1"                        â”‚
â”‚                                                                â”‚
â”‚  # Login as admin                                              â”‚
â”‚  r = requests.post(f"{BASE}/auth/login",                      â”‚
â”‚      json={"username":"admin","password":"admin123"})         â”‚
â”‚  admin_token = r.json()["access_token"]                       â”‚
â”‚                                                                â”‚
â”‚  # List users (admin only)                                     â”‚
â”‚  headers = {"Authorization": f"Bearer {admin_token}"}         â”‚
â”‚  r = requests.get(f"{BASE}/users/", headers=headers)          â”‚
â”‚  users = r.json()                                              â”‚
â”‚  print(f"Total users: {len(users)}")                          â”‚
â”‚                                                                â”‚
â”‚  # Promote user to admin                                       â”‚
â”‚  r = requests.put(f"{BASE}/users/2/role",                     â”‚
â”‚      headers=headers, json={"role": "admin"})                 â”‚
â”‚  print(f"Promoted: {r.json()['username']}")                   â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Error Responses â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  403 Forbidden:                                                â”‚
â”‚    {                                                           â”‚
â”‚      "detail": "Not enough permissions.                       â”‚
â”‚                 Admin access required."                        â”‚
â”‚    }                                                           â”‚
â”‚    â†’ User tried to access admin endpoint                      â”‚
â”‚                                                                â”‚
â”‚  400 Bad Request:                                              â”‚
â”‚    {                                                           â”‚
â”‚      "detail": "You cannot change your own role"              â”‚
â”‚    }                                                           â”‚
â”‚    â†’ Admin tried to change their own role                     â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Database Migration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  If you have existing database with users:                    â”‚
â”‚                                                                â”‚
â”‚  Option 1: Drop and recreate (loses data!)                    â”‚
â”‚    $ python init_db.py --drop                                 â”‚
â”‚                                                                â”‚
â”‚  Option 2: Manual SQL migration                               â”‚
â”‚    ALTER TABLE users                                           â”‚
â”‚      ADD COLUMN role ENUM('user','admin')                     â”‚
â”‚      DEFAULT 'user' NOT NULL;                                 â”‚
â”‚                                                                â”‚
â”‚    UPDATE users SET role = 'admin' WHERE id = 1;              â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Documentation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  ğŸ“– RBAC_GUIDE.md         â†’ Complete RBAC documentation       â”‚
â”‚  ğŸ“– AUTH_GUIDE.md          â†’ Authentication guide             â”‚
â”‚  ğŸ“– AUTHENTICATION_UPDATE.txt â†’ Token system                  â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âœ¨ Role-based access control is ready! âœ¨                    â•‘
â•‘                                                                â•‘
â•‘  Initialize DB and start managing users!                      â•‘
â•‘                                                                â•‘
â•‘  $ python init_db.py                                           â•‘
â•‘  $ python run.py                                               â•‘
â•‘                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
